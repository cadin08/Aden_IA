<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aden â€” Asistente Local Amistoso (v3+ con FAQ)</title>
<style>
/* =========================================================================
   Aden v3+ con Panel FAQ desplegable
   - Mantiene la estÃ©tica anterior (oscuro, limpio).
   - AÃ±ade drawer/floating button en esquina con todas las preguntas.
   ========================================================================= */

:root{
  --bg-0:#07121a;
  --bg-1:#0e1a27;
  --panel:#11202b;
  --glass: rgba(255,255,255,0.03);
  --muted:#9fb0c6;
  --accent-1:#57e4b8;
  --accent-2:#6fb7ff;
  --danger:#ff6b6b;
  --card:#0b1720;
  --radius:14px;
  --shadow: 0 14px 36px rgba(2,8,23,0.6);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color-scheme: dark;
}

/* Base layout (copiado / adaptado de la versiÃ³n previa) */
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-0),var(--bg-1));color:#e9f4ff;-webkit-font-smoothing:antialiased;}
.wrap{max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:340px 1fr;gap:20px;min-height:760px}

/* Sidebar */
.sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#022b2a;font-size:18px;box-shadow:0 6px 18px rgba(87,228,184,0.06)}
.brand h1{margin:0;font-size:16px}
.brand p{margin:0;color:var(--muted);font-size:12px}
.controls{display:flex;gap:8px;margin-top:12px}
.btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;color:var(--muted);cursor:pointer;font-size:13px}
.btn.primary{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));border:none;color:#052a26;font-weight:700}
.btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.03)}
.btn.small{padding:6px 8px;font-size:12px}

/* Search / chats list */
.search{display:flex;gap:8px;margin-top:12px;align-items:center}
.search input{flex:1;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
.meta-pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted)}
.chats{margin-top:12px;flex:1;overflow:auto;display:flex;flex-direction:column;gap:10px;padding-right:6px}
.chat-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);cursor:pointer;border:1px solid transparent;transition:all .18s}
.chat-item:hover{transform:translateY(-4px);box-shadow:0 10px 28px rgba(2,6,23,0.35)}
.chat-item.active{outline:2px solid rgba(87,228,184,0.08)}
.chat-thumb{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#c7f9e8,#9fd1ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#022}
.chat-meta h4{margin:0;font-size:13px}
.chat-meta p{margin:0;font-size:12px;color:var(--muted)}

/* Panel principal */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);display:flex;flex-direction:column}
.panel-header{display:flex;align-items:center;justify-content:space-between}
.panel-header .left{display:flex;gap:12px;align-items:center}
.panel-header h2{margin:0;font-size:18px}
.panel-actions{display:flex;gap:8px}
.messages{flex:1;margin-top:14px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);overflow:auto;border:1px dashed rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px}
.bubble{max-width:78%;padding:12px 14px;border-radius:14px;line-height:1.45;box-shadow:0 8px 22px rgba(2,6,23,0.45)}
.bubble.user{align-self:flex-end;background:linear-gradient(180deg,#071425,#061422);border:1px solid rgba(255,255,255,0.02)}
.bubble.assistant{align-self:flex-start;background:linear-gradient(180deg,#022b2a,#062c3c);border:1px solid rgba(255,255,255,0.02)}
.bubble .meta{font-size:11px;color:var(--muted);margin-top:8px;display:flex;justify-content:space-between}
.compose{display:flex;gap:12px;margin-top:12px;align-items:flex-end}
textarea{flex:1;padding:14px;border-radius:12px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);min-height:68px;resize:none}
.compose .right{display:flex;flex-direction:column;gap:8px}
.tiny{display:flex;gap:8px;align-items:center;margin-top:8px;font-size:12px;color:var(--muted)}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.02);cursor:pointer;border:1px solid rgba(255,255,255,0.02);font-size:13px}
.chip:hover{transform:translateY(-3px)}
.typing{display:inline-block;vertical-align:middle;width:56px;height:14px}
.typing span{display:inline-block;width:9px;height:9px;border-radius:50%;background:rgba(255,255,255,0.12);margin-right:6px;animation:dots 1.2s infinite}
.typing span:nth-child(2){animation-delay:.12s}
.typing span:nth-child(3){animation-delay:.24s}
@keyframes dots{0%{transform:translateY(0);opacity:.4}50%{transform:translateY(-6px);opacity:1}100%{transform:translateY(0);opacity:.4}}
@media (max-width:980px){.wrap{grid-template-columns:1fr;padding:12px}.sidebar{order:2}}
.muted{color:var(--muted)}
.danger{color:var(--danger)}
.fade-in{animation:fadeIn .28s ease both}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.settings-panel{margin-top:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.012);border:1px solid rgba(255,255,255,0.02)}
.toggle{display:flex;align-items:center;gap:10px}
.kbd{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;font-size:12px}
.footer-bar{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;margin-top:12px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
.small{font-size:12px;color:var(--muted)}
.accent{color:var(--accent-1)}
.search-highlight{background:linear-gradient(90deg, rgba(111,183,255,0.12), rgba(87,228,184,0.06));padding:4px 8px;border-radius:8px}
.voice-row{display:flex;gap:8px;align-items:center;margin-top:8px}
.voice-btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
.voice-btn.active{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#052a26}
[tabindex="0"]:focus{outline:2px solid rgba(111,183,255,0.08)}
.hr{border-top:1px dashed rgba(255,255,255,0.02);margin:10px 0}
.center{display:flex;align-items:center;justify-content:center}
@media (min-width:1400px){.wrap{max-width:1400px}}

/* =========================
   FAQ Drawer & Floating Button
   ========================= */

/* floating button bottom-right */
#faqToggle {
  position: fixed;
  right: 18px;
  bottom: 18px;
  width:56px;
  height:56px;
  border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
  color:#052a26;font-weight:800;border:none;box-shadow:0 12px 30px rgba(2,8,23,0.6);
  cursor:pointer;z-index:1200;
}

/* drawer */
#faqDrawer {
  position: fixed;
  right: 18px;
  bottom: 86px; /* above the button */
  width: 380px;
  max-height: 70vh;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px;
  box-shadow: 0 20px 60px rgba(2,8,23,0.6);
  z-index:1200;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transform: translateY(12px) scale(0.98);
  opacity:0;
  transition: all .18s ease;
  pointer-events:none;
  border:1px solid rgba(255,255,255,0.02);
}

/* when open */
#faqDrawer.open { transform: none; opacity:1; pointer-events:auto; }

/* header inside drawer */
#faqDrawer .header { padding:12px 14px; border-bottom:1px dashed rgba(255,255,255,0.02); display:flex;justify-content:space-between;align-items:center;}
#faqDrawer .header .title{font-weight:700}
#faqDrawer .header .muted{font-size:12px;color:var(--muted)}

/* search inside drawer */
#faqSearch { width: calc(100% - 28px); margin:8px 14px; padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03); color:var(--muted) }

/* list */
#faqList { overflow:auto; padding:10px 8px; display:flex; flex-direction:column; gap:8px; }

/* each faq item */
.faq-item { padding:10px; border-radius:10px; background: rgba(255,255,255,0.01); display:flex; flex-direction:column; gap:6px; border:1px solid rgba(255,255,255,0.02); }
.faq-item .q { font-weight:700; font-size:13px; }
.faq-item .a { font-size:13px; color:var(--muted); }
.faq-item .controls { display:flex; gap:8px; margin-top:6px; }
.faq-item .controls button { padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:var(--muted); cursor:pointer; font-size:13px }
.faq-empty { padding:14px; text-align:center; color:var(--muted) }

/* small footer inside drawer */
#faqDrawer .footer { padding:10px 12px; border-top:1px dashed rgba(255,255,255,0.02); display:flex; justify-content:space-between; align-items:center; font-size:12px; color:var(--muted) }

</style>
</head>
<body>
<div class="wrap" role="application" aria-label="Asistente Aden">
  <!-- SIDEBAR -->
  <aside class="sidebar" aria-label="Barra lateral">
    <div class="brand">
      <div class="logo" title="Asistente Aden">ADN</div>
      <div>
        <h1 id="brandName">Aden â€” Asistente Local</h1>
        <p id="brandTag">VersiÃ³n amistosa Â· solo texto Â· LocalStorage</p>
      </div>
    </div>

    <div class="controls" aria-hidden="false">
      <button id="newChatBtn" class="btn primary" title="Crear nuevo chat">+ Nuevo</button>
      <button id="importBtn" class="btn" title="Importar chats JSON">Importar</button>
      <button id="exportAllBtn" class="btn" title="Exportar todos los chats">Exportar</button>
    </div>

    <div class="search" role="search" aria-label="Buscar chats">
      <input id="searchChats" placeholder="Buscar chats o palabras clave..." aria-label="Buscar chats"/>
      <div class="meta-pill" id="chatCount" aria-live="polite">0</div>
    </div>

    <div class="chats" id="chatsList" tabindex="0" aria-live="polite" aria-label="Lista de chats"></div>

    <div class="settings-panel" aria-label="Ajustes rÃ¡pidos">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">LÃ­mite respuestas/chat</div>
          <div class="muted" id="limitDisplay">12</div>
        </div>
        <div style="display:flex;gap:8px">
          <button id="decLimit" class="btn">-</button>
          <button id="incLimit" class="btn">+</button>
          <button id="resetLocal" class="btn">Reset</button>
        </div>
      </div>

      <div class="hr"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
        <div>
          <div class="small">Voz &mdash; Lector</div>
          <div class="muted">Sintetizador de voz local (SpeechSynthesis)</div>
        </div>
        <div>
          <label class="toggle">
            <input id="voiceMasterToggle" type="checkbox" aria-label="Activar/Desactivar voz"/>
            <span class="kbd">Activar</span>
          </label>
        </div>
      </div>

      <div class="voice-row" aria-label="Selector de voz">
        <button id="voiceAuto" class="voice-btn active" title="AutomÃ¡tico">AutomÃ¡tico</button>
        <button id="voiceMale" class="voice-btn" title="Forzar voz masculina">Masculina</button>
        <button id="voiceFemale" class="voice-btn" title="Forzar voz femenina">Femenina</button>
      </div>

      <div style="margin-top:10px">
        <div class="small">Personalidad</div>
        <div class="muted">La personalidad por defecto se mantiene (amistosa y profesional).</div>
      </div>
    </div>

    <div class="footer-bar" aria-hidden="false">
      <div>
        <div class="small">Atajos</div>
        <div class="muted">Enter = enviar Â· Shift+Enter = nueva lÃ­nea</div>
      </div>
      <div style="text-align:right">
        <div class="small accent">Aden v3+</div>
        <div class="muted">Local Â· Off-line</div>
      </div>
    </div>
  </aside>

  <!-- MAIN PANEL -->
  <main class="panel" role="main">
    <div class="panel-header">
      <div class="left">
        <h2 id="panelTitle">Bienvenido â€” selecciona o crea un chat</h2>
        <div class="muted" id="responsesLeft"></div>
      </div>
      <div class="panel-actions">
        <button id="renameChatBtn" class="btn" title="Renombrar chat">Renombrar</button>
        <button id="clearChatBtn" class="btn" title="Vaciar mensajes">Vaciar</button>
        <button id="deleteChatBtn" class="btn danger" title="Eliminar chat">Eliminar</button>
      </div>
    </div>

    <div class="messages" id="messagesArea" aria-live="polite" aria-label="Mensajes">
      <div class="muted">Crea un chat y escribe algo. Prueba: "hola", "cuÃ©ntame un chiste", "quiÃ©n te creÃ³".</div>
    </div>

    <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
      <div class="chips" id="suggestions" aria-hidden="false"></div>

      <div class="compose" role="form" aria-label="Enviar mensaje">
        <textarea id="inputTxt" placeholder="Escribe tu mensaje... (Enter = enviar, Shift+Enter = nueva lÃ­nea)" aria-label="Mensaje"></textarea>
        <div class="right">
          <button id="sendBtn" class="btn primary">Enviar (Enter)</button>
          <div style="display:flex;flex-direction:column;gap:6px">
            <div style="display:flex;gap:6px"><button id="undoBtn" class="btn ghost" title="Deshacer">â†¶</button><button id="redoBtn" class="btn ghost" title="Rehacer">â†·</button></div>
            <div class="muted" id="charCount">0 caracteres</div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- FAQ Toggle Button -->
<button id="faqToggle" title="Mostrar preguntas (FAQ)">FAQ</button>

<!-- FAQ Drawer -->
<div id="faqDrawer" aria-hidden="true">
  <div class="header">
    <div>
      <div class="title">Preguntas que Aden entiende</div>
      <div class="muted">Haz clic en "Pegar" o "Enviar" para usar una pregunta</div>
    </div>
    <div class="muted">Total: <span id="faqCount">0</span></div>
  </div>

  <input id="faqSearch" placeholder="Buscar en preguntas (ej: hora, chiste, python)"/>

  <div id="faqList"></div>

  <div class="footer">
    <div class="muted">Tip: pulsa "Enviar" para enviar inmediatamente.</div>
    <div><button id="faqClose" class="btn small">Cerrar</button></div>
  </div>
</div>

<script>
/* =========================================================================
   Aden v3+ con FAQ - JavaScript
   - Este fichero actualiza la versiÃ³n anterior.
   - Se ha aÃ±adido: panel FAQ desplegable, mÃ¡s preguntas y respuestas,
     interacciones mÃ¡s humanas (variaciones), y enlace rÃ¡pido desde el FAQ.
   ========================================================================= */

/* -----------------------
   Estado & ConfiguraciÃ³n
   ----------------------- */
const STORAGE_KEY = 'aden_local';
const DEFAULT_LIMIT = 12;
let chats = [];
let activeChatId = null;
let responsesLimit = DEFAULT_LIMIT;
let undoStack = [], redoStack = [];
let ttsEnabled = false;
let ttsMode = 'auto'; // 'auto' | 'male' | 'female'
let voiceMap = {};
let lastAssistantUtterance = '';

/* Utilidades */
function uid(prefix='id'){ return prefix+'-'+Math.random().toString(36).slice(2,12); }
function saveChats(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(chats)); }
function loadChats(){
  const saved = localStorage.getItem(STORAGE_KEY);
  if(saved){
    try{ chats = JSON.parse(saved) || []; } catch(e){ console.warn('localStorage parse error', e); chats=[]; localStorage.removeItem(STORAGE_KEY); }
  } else chats = [];
  renderChatList();
}
function formatTime(ts){ const d = new Date(ts); return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* -----------------------
   Render lista de chats / mensajes
   ----------------------- */
function renderChatList(){
  const list = document.getElementById('chatsList'); list.innerHTML='';
  chats.sort((a,b)=>(b.updated||0)-(a.updated||0));
  chats.forEach(c=>{
    const div = document.createElement('div');
    div.className = 'chat-item fade-in';
    if(c.id === activeChatId) div.classList.add('active');
    const initial = c.name ? c.name[0].toUpperCase() : 'C';
    const mcount = (c.messages && c.messages.length) || 0;
    div.innerHTML = `<div class="chat-thumb" aria-hidden="true">${escapeHtml(initial)}</div>
      <div class="chat-meta"><h4>${escapeHtml(c.name)}</h4><p class="muted">${mcount} mensajes Â· ${c.updated?formatTime(c.updated):''}</p></div>`;
    div.onclick = ()=>{ activeChatId = c.id; renderChatList(); renderMessages(); updatePanelTitle(); };
    list.appendChild(div);
  });
  document.getElementById('chatCount').textContent = chats.length;
}

function getActiveChat(){ return chats.find(x=>x.id===activeChatId); }

function renderMessages(){
  const area = document.getElementById('messagesArea');
  area.innerHTML = '';
  const chat = getActiveChat();
  if(!chat){ area.innerHTML = '<div class="muted">Crea un chat y empieza a conversar con Aden ğŸ˜„</div>'; updatePanelTitle(); return; }
  if(!chat.messages || chat.messages.length===0){ area.innerHTML = '<div class="muted">Escribe algo para que Aden responda. Prueba: "hola", "cuÃ©ntame un chiste", "quiÃ©n te creÃ³".</div>'; updatePanelTitle(); return; }
  chat.messages.forEach(m=>{
    const div = document.createElement('div');
    div.className = 'bubble '+(m.role==='user'?'user':'assistant')+' fade-in';
    const ts = m.timestamp ? formatTime(m.timestamp) : '';
    const content = escapeHtml(m.text).replace(/\n/g,'<br>');
    div.innerHTML = `<div class="text">${content}</div><div class="meta"><span class="small muted">${m.role==='user'?'TÃº':'Aden'}</span><span class="muted small">${ts}</span></div>`;
    area.appendChild(div);
  });
  area.scrollTop = area.scrollHeight;
}

/* -----------------------
   Mensajes: aÃ±adir y guardar
   ----------------------- */
function addMessage(role, text){
  const chat = getActiveChat();
  if(!chat) return;
  const msg = { role, text: String(text), timestamp: Date.now() };
  chat.messages.push(msg);
  chat.updated = Date.now();
  saveChats();
  renderMessages();
  renderChatList();
  if(role === 'assistant'){
    lastAssistantUtterance = text;
    if(!chat.meta) chat.meta = {};
    chat.meta.greeted = true;
    if(ttsEnabled) speakWithMode(text, detectEmotionSimple(text));
  }
}

/* -----------------------
   Crear, borrar, renombrar, limpiar
   ----------------------- */
function createNewChat(initialName){
  const id = uid('chat');
  const name = initialName || ('Chat '+(chats.length+1));
  const newChat = { id, name, messages: [], created: Date.now(), updated: Date.now(), meta: { greeted:false } };
  chats.push(newChat);
  activeChatId = id;
  saveChats();
  renderChatList();
  renderMessages();
  updatePanelTitle();
  // Mensaje de bienvenida (suave)
  addMessage('assistant','Â¡Hola! Soy Aden, tu asistente local. Â¿En quÃ© puedo ayudarte hoy?');
}
function deleteActiveChat(){
  if(!activeChatId) return;
  const idx = chats.findIndex(c=>c.id===activeChatId);
  if(idx>=0){
    if(!confirm('Â¿Seguro que quieres eliminar este chat?')) return;
    chats.splice(idx,1);
    activeChatId = chats.length ? chats[0].id : null;
    saveChats(); renderChatList(); renderMessages(); updatePanelTitle();
  }
}
function clearActiveChat(){
  const chat = getActiveChat();
  if(!chat) return;
  if(!confirm('Vaciar mensajes del chat actual?')) return;
  chat.messages = []; chat.updated = Date.now(); chat.meta = { greeted:false };
  saveChats(); renderMessages(); renderChatList();
}
function renameActiveChat(){
  const chat = getActiveChat();
  if(!chat) return alert('Selecciona un chat primero.');
  const newName = prompt('Nuevo nombre del chat:', chat.name);
  if(newName && newName.trim()){ chat.name = newName.trim(); chat.updated = Date.now(); saveChats(); renderChatList(); updatePanelTitle(); }
}

/* -----------------------
   Export / Import JSON
   ----------------------- */
function exportAllChats(){ const dataStr = JSON.stringify(chats,null,2); const blob = new Blob([dataStr],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='aden_chats_export.json'; a.click(); URL.revokeObjectURL(url); }
function importChatsFromFile(file){ const reader = new FileReader(); reader.onload = (e)=>{ try{ const parsed = JSON.parse(e.target.result); if(Array.isArray(parsed)){ parsed.forEach(p=>{ if(!p.id) p.id = uid('chat'); if(!p.messages) p.messages = []; if(!p.meta) p.meta = { greeted:false }; }); chats = chats.concat(parsed); saveChats(); renderChatList(); alert('ImportaciÃ³n completa.'); } else alert('Formato invÃ¡lido: se esperaba un array de chats.'); } catch(err){ alert('Error al importar: '+err.message); } }; reader.readAsText(file); }

/* -----------------------
   Text-to-Speech (TTS)
   ----------------------- */
function getAvailableVoices(){ return window.speechSynthesis ? window.speechSynthesis.getVoices() : []; }
function chooseVoice(preference='auto', intention='neutral'){
  if(!('speechSynthesis' in window)) return null;
  const voices = getAvailableVoices();
  if(!voices || voices.length===0) return null;
  const esVoices = voices.filter(v=>/(^es|spanish|es-)/i.test(v.lang) || /spanish|espaÃ±ol/i.test(v.name));
  const pool = esVoices.length ? esVoices : voices;
  // heurÃ­stica simple
  let chosen = null;
  if(preference === 'male'){
    chosen = pool.find(v=>/male|hombre|masculin/i.test(v.name)) || pool[0];
  } else if(preference === 'female'){
    chosen = pool.find(v=>/female|mujer|femenin|female/i.test(v.name)) || pool[0];
  } else {
    if(intention === 'empathic') chosen = pool.find(v=>/soft|natural|calm|ana|laura|maria|marta/i.test(v.name)) || pool[0];
    else chosen = pool.find(v=>/standard|es-ES|es-419/i.test(v.name)) || pool[0];
  }
  return chosen;
}
function speakTextUtterance(text, voiceObj=null, rate=1, pitch=1, lang='es-ES'){
  if(!('speechSynthesis' in window)) return;
  try{ window.speechSynthesis.cancel(); const ut = new SpeechSynthesisUtterance(String(text)); if(voiceObj) ut.voice = voiceObj; ut.rate = rate; ut.pitch = pitch; ut.lang = lang; window.speechSynthesis.speak(ut); } catch(e){ console.warn('TTS error', e); }
}
function speakWithMode(text, intention='neutral'){
  if(!ttsEnabled) return;
  const pref = ttsMode || 'auto';
  const voice = chooseVoice(pref, intention);
  let rate = 1.0, pitch = 1.0;
  if(intention === 'empathic'){ rate = 0.95; pitch = 1.05; }
  else if(intention === 'alert'){ rate = 1.1; pitch = 1.0; }
  speakTextUtterance(text, voice, rate, pitch, 'es-ES');
}

/* -----------------------
   KEYWORD_ACTIONS: banco de triggers y handlers (ampliado)
   ----------------------- */
const KEYWORD_ACTIONS = [
  { keywords:['idiota','imbecil','tonto','estupido','estÃºpido','gilipollas','cabron','cabrÃ³n','mierda','puta','puto','hijo de puta','zorra','bobo','subnormal','payaso'], priority:999, handler: ()=> 'No seguirÃ© esta conversaciÃ³n si sigues asÃ­.' },
  { keywords:['quien te hizo','quien te creo','quien te creÃ³','quiÃ©n te creÃ³','quien te a hecho','quien te a creado','quien te ha creado','creador','programaste','programÃ³','fuiste creado por'], priority:980, handler: ()=> 'Aden ha sido creado por amor al arte por Hodei Arranz Romero.' },
  { keywords:['hora','horas','reloj','quÃ© hora','que hora','hora es'], priority:900, handler: ()=> `âŒš Ahora mismo es ${new Date().toLocaleTimeString()}.` },
  { keywords:['fecha','dÃ­a','dia','quÃ© dÃ­a','que dia','quÃ© fecha','que fecha','dÃ­a de hoy'], priority:860, handler: ()=> `ğŸ“… Hoy es ${new Date().toLocaleDateString('es-ES', {weekday:'long',year:'numeric',month:'long',day:'numeric'})}.` },
  { keywords:['x','*','por','multiplica','multiplicaciÃ³n'], priority:850, handler: (txt)=>{ const m1 = txt.match(/(-?\d+)\s*[x\*]\s*(-?\d+)/); if(m1){ const a=parseInt(m1[1],10), b=parseInt(m1[2],10); if(!isNaN(a)&&!isNaN(b)) return `ğŸ§® ${a} por ${b} es ${a*b}.`; } const m2 = txt.match(/multiplica\s+(-?\d+)\s+por\s+(-?\d+)/i); if(m2){ const a=parseInt(m2[1],10), b=parseInt(m2[2],10); if(!isNaN(a)&&!isNaN(b)) return `ğŸ§® ${a} por ${b} es ${a*b}.`; } return 'ğŸ§® Dime la multiplicaciÃ³n con nÃºmeros, por ejemplo: "25 x 47"'; } },
  { keywords:['chiste','cuentame un chiste','cuÃ©ntame un chiste','dime un chiste','hazme reir'], priority:820, handler: ()=> { const jokes = ['ğŸ˜‚ Â¿QuÃ© hace una abeja en el gimnasio? Â¡Zum-ba!','ğŸ¤£ Â¿Por quÃ© los pÃ¡jaros no usan Facebook? Â¡Porque ya tienen Twitter!','ğŸ˜„ Â¿CuÃ¡l es el colmo de un electricista? Que le dÃ© miedo la oscuridad.','ğŸ˜† Â¿Por quÃ© el libro de matemÃ¡ticas estaba triste? Porque tenÃ­a muchos problemas.']; return jokes[Math.floor(Math.random()*jokes.length)]; } },
  { keywords:['traduce','traducir','traducciÃ³n'], priority:800, handler: (txt)=>{ const after = txt.split(/traduce[:\s]|traducir[:\s]/i)[1]; if(after && after.trim()) return `ğŸŒ TraducciÃ³n (simulada): "${after.trim()}" => (ejemplo offline).`; return 'ğŸŒ Dime el texto que quieres traducir despuÃ©s de "traduce" o "traducir".'; } },
  { keywords:['triste','deprim','alegre','feliz','ansiedad','ansioso','ansiosa','enfadado','enojado','solo','sola','solo.'], priority:790, handler: (txt)=>{ if(/triste|deprim/i.test(txt)) return chooseVariation(['Siento que te sientas asÃ­. Si quieres, puedo escucharte y darte algunas ideas para animarte.','Lo siento â€” te acompaÃ±o. Â¿Quieres que hablemos un rato?','Lamento que te sientas asÃ­. Â¿Te apetece un consejo sencillo para mejorar el Ã¡nimo?']); if(/ansiedad|ansioso|ansiosa|estres|estrÃ©s/i.test(txt)) return chooseVariation(['Respirar profundamente 4-4-4 puede ayudar. Â¿Quieres que te guÃ­e?','Intentar respirar despacio 5 minutos ayuda a calmar la ansiedad. Â¿Lo intentamos?']); if(/enfadad|enojad|cabre/i.test(txt)) return chooseVariation(['Respirar y dar un paso atrÃ¡s suele funcionar. Â¿Quieres distraerte con algo?','Lo entiendo. Â¿Quieres contarme por quÃ© te enfada?']); return 'Si quieres, cuÃ©ntame mÃ¡s.'; } },
  { keywords:['inteligencia artificial','ia','agujero negro','everest','tokio','capital de japÃ³n','capital japon','rusia'], priority:650, handler: (txt)=>{ if(/inteligencia artificial|ia/.test(txt)) return 'ğŸ¤– La inteligencia artificial es la simulaciÃ³n de procesos inteligentes por mÃ¡quinas. Puedo darte ejemplos o explicarlo con analogÃ­as.'; if(/agujero negro/.test(txt)) return 'ğŸŒŒ Un agujero negro es una regiÃ³n del espacio con gravedad tan intensa que ni la luz puede escapar.'; if(/everest|montaÃ±a mÃ¡s alta/.test(txt)) return 'ğŸ—» El monte Everest es la montaÃ±a mÃ¡s alta (â‰ˆ8848 m).'; if(/capital.*jap|tokio/.test(txt)) return 'ğŸ¯ La capital de JapÃ³n es Tokio.'; if(/rusia|paÃ­s mÃ¡s grande/.test(txt)) return 'ğŸŒ Rusia es el paÃ­s mÃ¡s grande por superficie.'; return null; } },
  { keywords:['minecraft','juego','videojuego','steam','serie parecida','breaking bad','one piece','pelicula','pelÃ­culas'], priority:600, handler: (txt)=>{ if(/minecraft/.test(txt)) return 'â›ï¸ Si te gusta Minecraft, quizÃ¡ disfrutes tambiÃ©n de Terraria o Stardew Valley.'; if(/breaking bad|serie parecida/.test(txt)) return 'ğŸ“º Te recomiendo "Better Call Saul" si te gustÃ³ Breaking Bad.'; if(/one piece/.test(txt)) return 'ğŸ–¥ï¸ Puedes ver One Piece en plataformas como Crunchyroll o Netflix segÃºn tu regiÃ³n.'; if(/steam/.test(txt)) return 'ğŸ® Para ofertas en Steam, revisa su secciÃ³n de rebajas.'; return null; } },
  { keywords:['receta','comer','cocina','cena','almuerzo','desayuno','comida'], priority:560, handler: (txt)=>{ if(/receta.*pasta|pasta/.test(txt)) return 'ğŸ Una receta rÃ¡pida: pasta con tomate, ajo, aceite, albahaca y queso. Â¿Quieres la receta paso a paso?'; if(/receta.*tortilla|tortilla/.test(txt)) return 'ğŸ¥š Tortilla: bate huevos, saltea patata/pimiento, mezcla y cocina a fuego medio.'; return 'Â¿QuÃ© te apetece cocinar? Dime un ingrediente y te doy ideas.'; } },
  { keywords:['programacion','python','javascript','html','css','git','npm','linux','bash','regex'], priority:540, handler: (txt)=>{ if(/python/.test(txt)) return 'ğŸ Python es genial para scripting y ciencia de datos. Â¿Quieres un ejemplo rÃ¡pido?'; if(/javascript/.test(txt)) return 'ğŸ“œ JavaScript es el lenguaje de la web. Â¿Necesitas un snippet para DOM, fetch o async/await?'; if(/git/.test(txt)) return 'ğŸ”§ Git: usa "git status", "git add .", "git commit -m \'msg\'" y "git push". Â¿Quieres ayuda con un conflicto?'; if(/linux|bash/.test(txt)) return 'ğŸ§ Para sistemas Linux puedes usar "top", "htop", "ls -la" y "journalctl -xe". Â¿QuÃ© distro usas?'; return null; } },
  { keywords:['salud','dolor','fiebre','resfriado','medicina'], priority:520, handler: (txt)=>{ return 'No soy mÃ©dico, pero si tienes sÃ­ntomas persistentes te recomiendo consultar con un profesional. Puedo ofrecer consejos generales (descanso, hidrataciÃ³n, controlar temperatura).'; } },
  { keywords:['productividad','todo','tareas','organizar','planificar','agenda'], priority:500, handler: (txt)=>{ return chooseVariation(['Organiza en bloques pequeÃ±os (25â€“50 min), descansa 5â€“10 min entre ellos. Â¿Quieres que te sugiera un plan de hoy?','Probar la tÃ©cnica Pomodoro ayuda a concentrarte: 25 minutos trabajo / 5 descanso.']); } },
  { keywords:['motivaciÃ³n','frase motivadora','Ã¡nimo','Ã¡nimo por favor','inspiraciÃ³n','cita inspiradora'], priority:450, handler: (txt)=>{ const quotes = ['ğŸ’¬ â€œHazlo con miedo, pero hazlo.â€','ğŸ’ª â€œPequeÃ±os pasos cada dÃ­a llevan lejos.â€','ğŸŒ± â€œNo es quiÃ©n eres, es quiÃ©n decides ser.â€']; return quotes[Math.floor(Math.random()*quotes.length)]; } },
  { keywords:['_default_'], priority:1, handler: ()=> 'ğŸ˜… No estoy seguro de eso. Intenta con otra palabra clave o pregunta de forma distinta.' }
];

/* -----------------------
   NormalizaciÃ³n / matching
   ----------------------- */
function normalizeText(s){ return (s||'').toString().toLowerCase(); }
function tokenize(s){ return (s||'').toString().toLowerCase().split(/[^a-z0-9Ã¡Ã©Ã­Ã³ÃºÃ±Ã¼]+/).filter(Boolean); }

function chooseVariation(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* findResponseByKeyword: detecta keywords y retorna respuesta */
function findResponseByKeyword(userText){
  const txt = normalizeText(userText);
  const tokens = tokenize(txt);
  const matched = [];
  for(const action of KEYWORD_ACTIONS){
    for(const kw of action.keywords){
      if(kw === '_default_') continue;
      const lkw = kw.toString().toLowerCase();
      if(txt.includes(lkw) || tokens.includes(lkw)){ matched.push(action); break; }
    }
  }
  if(matched.length > 0){
    matched.sort((a,b)=>b.priority - a.priority);
    const chosen = matched[0];
    try{ if(typeof chosen.handler === 'function') return chosen.handler(userText); return String(chosen.handler); } catch(err){ console.warn('Error handler', err); return 'Lo siento, algo fallÃ³ al procesar la respuesta.'; }
  }
  const fallback = KEYWORD_ACTIONS.find(a=>a.keywords.includes('_default_'));
  return fallback ? fallback.handler() : 'No lo sÃ©.';
}

/* -----------------------
   EmociÃ³n simple
   ----------------------- */
function detectEmotionSimple(text){
  const t = normalizeText(text);
  if(/triste|deprim|melancol|llor|nostÃ¡lg|solo|sola|ansiedad|ansioso|ansiosa|angustia/.test(t)) return 'empathic';
  if(/enfadad|enojad|cabre|rabia|furia/.test(t)) return 'alert';
  return 'neutral';
}

/* -----------------------
   generateResponse: controla presentaciÃ³n y variaciones humanas
   ----------------------- */
function generateResponse(userText){
  if(!userText) return '';
  const chat = getActiveChat();
  // si chat existe y no ha saludado, no forzar presentaciÃ³n si user pregunta algo concreto
  let resp = findResponseByKeyword(userText);
  // Evitar repeticiones exactas de la presentaciÃ³n si ya saludÃ³
  if(chat && chat.meta && chat.meta.greeted && typeof resp === 'string' && /hola|soy aden|asistente local/i.test(resp)){
    const alternatives = ['Â¿Puedes explicar un poco mÃ¡s?', 'Interesante â€” cuÃ©ntame mÃ¡s.', 'No estoy seguro de eso, Â¿me lo reformulas?'];
    return alternatives[Math.floor(Math.random()*alternatives.length)];
  }
  if(chat){ if(!chat.meta) chat.meta = {}; chat.meta.greeted = true; }
  return resp || 'ğŸ˜… No estoy seguro de eso; prueba con otra pregunta.';
}

/* SimulaciÃ³n de typing */
let typingTimer = null;
function simulateAdenTypingAndRespond(userText){
  const messagesArea = document.getElementById('messagesArea');
  const indicator = document.createElement('div');
  indicator.className = 'bubble assistant fade-in';
  indicator.innerHTML = `<div class="text"><span class="typing"><span></span><span></span><span></span></span> Aden estÃ¡ escribiendo...</div>`;
  messagesArea.appendChild(indicator);
  messagesArea.scrollTop = messagesArea.scrollHeight;
  const wait = 250 + Math.random()*900;
  if(typingTimer) clearTimeout(typingTimer);
  typingTimer = setTimeout(()=>{
    indicator.remove();
    const answer = generateResponse(userText);
    addMessage('assistant', answer);
  }, wait);
}

/* -----------------------
   Input handlers
   ----------------------- */
function handleUserInput(){
  const inputEl = document.getElementById('inputTxt');
  const txt = inputEl.value.trim();
  if(!txt) return;
  addMessage('user', txt);
  undoStack.push(txt); redoStack = [];
  inputEl.value = '';
  updateCharCount();
  simulateAdenTypingAndRespond(txt);
}

/* keyboard */
document.getElementById('inputTxt').addEventListener('keydown', e=>{
  if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); handleUserInput(); }
});

/* undo/redo */
document.getElementById('undoBtn').onclick = ()=>{ if(undoStack.length===0) return; const last = undoStack.pop(); redoStack.push(last); document.getElementById('inputTxt').value = undoStack.length ? undoStack[undoStack.length-1] : ''; updateCharCount(); };
document.getElementById('redoBtn').onclick = ()=>{ if(redoStack.length===0) return; const next = redoStack.pop(); undoStack.push(next); document.getElementById('inputTxt').value = next; updateCharCount(); };

/* botones principales */
document.getElementById('newChatBtn').onclick = ()=> createNewChat();
document.getElementById('sendBtn').onclick = ()=> handleUserInput();
document.getElementById('decLimit').onclick = ()=>{ responsesLimit = Math.max(1, responsesLimit-1); document.getElementById('limitDisplay').textContent = responsesLimit; };
document.getElementById('incLimit').onclick = ()=>{ responsesLimit = Math.min(100, responsesLimit+1); document.getElementById('limitDisplay').textContent = responsesLimit; };
document.getElementById('resetLocal').onclick = ()=>{ if(confirm('Resetear Aden: eliminar todos los chats y ajustes?')){ localStorage.removeItem(STORAGE_KEY); chats=[]; activeChatId=null; responsesLimit = DEFAULT_LIMIT; document.getElementById('limitDisplay').textContent = responsesLimit; loadChats(); renderMessages(); } };
document.getElementById('renameChatBtn').onclick = renameActiveChat;
document.getElementById('clearChatBtn').onclick = clearActiveChat;
document.getElementById('deleteChatBtn').onclick = deleteActiveChat;
document.getElementById('exportAllBtn').onclick = exportAllChats;
document.getElementById('importBtn').onclick = ()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange=(e)=>{ const f=e.target.files[0]; if(f) importChatsFromFile(f); }; inp.click(); };

/* search chats */
document.getElementById('searchChats').addEventListener('input', e=>{
  const q = e.target.value.trim().toLowerCase();
  const list = document.getElementById('chatsList'); list.innerHTML = '';
  const filtered = chats.filter(c=>{ if(!q) return true; const nm = c.name.toLowerCase(); const anyMsg = (c.messages||[]).some(m=> (m.text||'').toLowerCase().includes(q)); return nm.includes(q) || anyMsg; });
  filtered.forEach(c=>{ const div=document.createElement('div'); div.className='chat-item fade-in'; if(c.id===activeChatId) div.classList.add('active'); div.innerHTML=`<div class="chat-thumb">${escapeHtml(c.name[0]||'C')}</div><div class="chat-meta"><h4>${escapeHtml(c.name)}</h4><p class="muted">${(c.messages||[]).length} mensajes Â· ${c.updated?formatTime(c.updated):''}</p></div>`; div.onclick=()=>{ activeChatId=c.id; renderChatList(); renderMessages(); updatePanelTitle(); }; list.appendChild(div); });
  document.getElementById('chatCount').textContent = filtered.length;
});

/* suggestions */
const SUGGESTIONS = ['hola','quiÃ©n te creÃ³','cuÃ©ntame un chiste','hora','fecha','traduce: hola mundo','25 x 47','me siento triste','quÃ© es la inteligencia artificial','receta pasta','ayuda con python','cÃ³mo usar git'];
function renderSuggestions(){ const container=document.getElementById('suggestions'); container.innerHTML=''; SUGGESTIONS.forEach(s=>{ const c=document.createElement('div'); c.className='chip'; c.innerText=s; c.onclick=()=>{ document.getElementById('inputTxt').value=s; updateCharCount(); document.getElementById('inputTxt').focus(); }; container.appendChild(c); }); }

/* char counter */
function updateCharCount(){ const v = document.getElementById('inputTxt').value || ''; document.getElementById('charCount').textContent = `${v.length} caracteres`; }
document.getElementById('inputTxt').addEventListener('input', updateCharCount);

/* voice toggles */
document.getElementById('voiceMasterToggle').addEventListener('change', e=>{ ttsEnabled = e.target.checked; const k = document.querySelector('.kbd'); if(k) k.textContent = ttsEnabled ? 'Activado' : 'Desactivar'; if(!ttsEnabled && window.speechSynthesis) window.speechSynthesis.cancel(); });
document.getElementById('voiceAuto').addEventListener('click', ()=>{ ttsMode='auto'; setVoiceButtonsState(); });
document.getElementById('voiceMale').addEventListener('click', ()=>{ ttsMode='male'; setVoiceButtonsState(); });
document.getElementById('voiceFemale').addEventListener('click', ()=>{ ttsMode='female'; setVoiceButtonsState(); });
function setVoiceButtonsState(){ document.getElementById('voiceAuto').classList.toggle('active', ttsMode==='auto'); document.getElementById('voiceMale').classList.toggle('active', ttsMode==='male'); document.getElementById('voiceFemale').classList.toggle('active', ttsMode==='female'); }
window.speechSynthesis?.addEventListener?.('voiceschanged', ()=>{ getAvailableVoices(); });

/* panel title */
function updatePanelTitle(){ const chat = getActiveChat(); const title = document.getElementById('panelTitle'); if(!chat) title.textContent = 'Bienvenido â€” selecciona o crea un chat'; else title.textContent = `${chat.name} Â· ${chat.messages.length} mensajes`; document.getElementById('responsesLeft').textContent = `LÃ­mite por chat: ${responsesLimit}`; }

/* -----------------------
   FAQ Drawer: datos y render
   ----------------------- */

/* FAQ_ITEMS: preguntas y respuestas legibles (esto es lo que se muestra en el panel) */
const FAQ_ITEMS = [
  { q:'Â¿QuÃ© hora es?', a: 'Aden responde con la hora actual de tu PC si detecta la palabra "hora".' },
  { q:'Â¿QuÃ© fecha es hoy?', a: 'Aden darÃ¡ la fecha local si detecta "fecha" o "dÃ­a".' },
  { q:'CuÃ©ntame un chiste', a: 'Aden tiene varios chistes guardados y variarÃ¡ entre ellos.' },
  { q:'Â¿QuiÃ©n te creÃ³?', a: 'Aden responderÃ¡: "Aden ha sido creado por amor al arte por Hodei Arranz Romero."' },
  { q:'Traduce: hola mundo', a: 'Aden ofrece una traducciÃ³n simulada offline al detectar "traduce".' },
  { q:'25 x 47', a: 'Aden detecta multiplicaciones escritas con "x" o "*" y las resuelve.' },
  { q:'Me siento triste', a: 'Aden detecta emociones (tristeza, ansiedad) y responde con empatÃ­a y opciones.' },
  { q:'RecuÃ©rdame cÃ³mo usar git', a: 'Aden ofrece comandos bÃ¡sicos de git al detectar "git".' },
  { q:'RecomiÃ©ndame un videojuego', a: 'Aden sugiere juegos segÃºn el input (ej. Minecraft -> Terraria, Stardew).' },
  { q:'Dame una receta rÃ¡pida', a: 'Aden puede proponer recetas sencillas segÃºn ingredientes que indiques.' },
  { q:'Â¿QuÃ© es la inteligencia artificial?', a: 'Aden explica IA en tÃ©rminos simples y puede dar ejemplos.' },
  { q:'Â¿CuÃ¡l es la capital de JapÃ³n?', a: 'Aden responde "Tokio".' },
  { q:'Â¿CuÃ¡l es el paÃ­s mÃ¡s grande?', a: 'Aden responde "Rusia".' },
  { q:'Â¿QuÃ© es un agujero negro?', a: 'Aden da una explicaciÃ³n breve y clara.' },
  { q:'Â¿CÃ³mo me organizo hoy?', a: 'Aden ofrece consejos de productividad, Pomodoro y planificaciÃ³n.' },
  { q:'Dime una frase motivadora', a: 'Aden ofrece frases motivadoras al detectar "motivaciÃ³n" o "Ã¡nimo".' },
  { q:'Â¿CÃ³mo traduzco un texto?', a: 'Escribe "traduce: [texto]" y Aden te darÃ¡ una traducciÃ³n simulada.' },
  { q:'Â¿QuÃ© opinas de Hodei?', a: 'Puedes aÃ±adir una respuesta personalizada para esa pregunta.' },
  { q:'Â¿Puedes decir una curiosidad?', a: 'Aden tiene datos curiosos sobre ciencia, historia y mÃ¡s.' },
  { q:'Consejos para el insomnio', a: 'Aden darÃ¡ consejos generales y sugerencias no mÃ©dicas.' },
  { q:'Â¿QuÃ© canciones conoces?', a: 'Aden tiene referencias musicales (ej. Despacito, gÃ©neros, etc.).' },
  { q:'Â¿CÃ³mo hago backup?', a: 'Aden puede explicar cÃ³mo hacer copias de seguridad en OneDrive y localmente.' },
  { q:'Â¿Tienes ejemplos de regex?', a: 'Aden puede dar ejemplos bÃ¡sicos de expresiones regulares.' },
  { q:'Â¿CÃ³mo instalar una SSD?', a: 'Aden puede explicar pasos bÃ¡sicos e indicaciones de seguridad.' },
  { q:'Â¿QuÃ© significa resiliencia?', a: 'Aden define conceptos como resiliencia en lenguaje simple.' },
  { q:'Ponme una lista de atajos', a: 'Aden puede enumerar atajos comunes segÃºn el sistema.' },
  { q:'Â¿Me puedes dar un currÃ­culum?', a: 'Aden ofrece estructura y ejemplos para redactar tu CV.' },
  { q:'Â¿QuÃ© dÃ­a es maÃ±ana?', a: 'Aden calcula la fecha de maÃ±ana si detecta la palabra "maÃ±ana".' },
  { q:'Â¿CuÃ¡nto tarda la luz del sol?', a: 'Aden responde: ~8 minutos y 20 segundos.' }
  /* Puedes expandir aquÃ­ directamente aÃ±adiendo mÃ¡s objetos {q,a} */
];

/* Render del drawer */
function renderFAQDrawer(filter=''){
  const list = document.getElementById('faqList');
  list.innerHTML = '';
  const q = (filter||'').trim().toLowerCase();
  const filtered = FAQ_ITEMS.filter(item => {
    if(!q) return true;
    return item.q.toLowerCase().includes(q) || item.a.toLowerCase().includes(q);
  });
  if(filtered.length === 0){ list.innerHTML = '<div class="faq-empty">No encuentro preguntas que coincidan.</div>'; document.getElementById('faqCount').textContent = 0; return; }
  filtered.forEach(item=>{
    const div = document.createElement('div');
    div.className = 'faq-item';
    div.innerHTML = `<div class="q">${escapeHtml(item.q)}</div><div class="a">${escapeHtml(item.a)}</div>`;
    const controls = document.createElement('div'); controls.className = 'controls';
    const btnPaste = document.createElement('button'); btnPaste.textContent = 'Pegar'; btnPaste.title='Pegar la pregunta en el cuadro de texto';
    btnPaste.onclick = ()=>{ document.getElementById('inputTxt').value = item.q; updateCharCount(); document.getElementById('inputTxt').focus(); };
    const btnSend = document.createElement('button'); btnSend.textContent = 'Enviar'; btnSend.title='Enviar la pregunta ahora';
    btnSend.onclick = ()=>{ document.getElementById('inputTxt').value = item.q; updateCharCount(); handleUserInput(); toggleFAQ(false); };
    controls.appendChild(btnPaste); controls.appendChild(btnSend);
    div.appendChild(controls);
    list.appendChild(div);
  });
  document.getElementById('faqCount').textContent = filtered.length;
}

/* FAQ toggle logic */
const faqToggleBtn = document.getElementById('faqToggle');
const faqDrawer = document.getElementById('faqDrawer');
const faqClose = document.getElementById('faqClose');
faqToggleBtn.addEventListener('click', ()=> toggleFAQ());
faqClose.addEventListener('click', ()=> toggleFAQ(false));
document.getElementById('faqSearch').addEventListener('input', (e)=> renderFAQDrawer(e.target.value));

function toggleFAQ(force){
  const open = faqDrawer.classList.contains('open');
  const shouldOpen = (typeof force === 'boolean') ? force : !open;
  faqDrawer.classList.toggle('open', shouldOpen);
  faqDrawer.setAttribute('aria-hidden', !shouldOpen);
}

/* -----------------------
   InicializaciÃ³n y carga
   ----------------------- */
function init(){
  loadChats();
  renderSuggestions();
  document.getElementById('limitDisplay').textContent = responsesLimit;
  setVoiceButtonsState();
  if(chats.length === 0) createNewChat('Bienvenida');
  if(!activeChatId && chats.length) activeChatId = chats[0].id;
  renderChatList();
  renderMessages();
  updatePanelTitle();
  document.getElementById('inputTxt').focus();
  renderFAQDrawer();
}

/* Llamada inicial */
init();

/* ============================
   Fin del script (FAQ aÃ±adido)
   ============================ */

// -----------------------
// NUEVAS PREGUNTAS/RESPUESTAS
// -----------------------


KEYWORD_ACTIONS.push(
// ========================
// SALUDOS y CONTEXTOS
// ========================

{ keywords:['Quien es Nicki Nicole','Nicki Nicole quien es','cuentame de Nicki Nicole'], priority:950, handler: ()=> chooseVariation([
  'Nicki Nicole, cuyo nombre real es Nicole Denise Cucco, es una cantante y compositora argentina de mÃºsica urbana, pop y R&B, nacida en Rosario. GanÃ³ popularidad en 2019 con el sencillo "Wapo Traketero" y se consolidÃ³ internacionalmente con su colaboraciÃ³n con Bizarrap en la "Music Sessions #13',
]) },

{ keywords:['Que movil me recomiendas','Me dices algun movil','Me recomiendas algun movil','Moviles'], priority:950, handler: ()=> chooseVariation([
  'Para jugar, trabajos intensivos, e IA avanzada, te recomiendo los Samsung Galaxy, Para creacion de contenido el Iphone es tu compaÃ±ero',
]) },

{ keywords:['cuentame un chiste','hazme reÃ­r','cuÃ©ntame algo divertido','diviÃ©rteme'], priority:850, handler: ()=> chooseVariation([
  'Â¿Sabes cuÃ¡l es el animal mÃ¡s antiguo? ğŸ¢ Â¡La cebra, porque estÃ¡ en blanco y negro! ğŸ˜†',
  'Â¿QuÃ© hace una abeja en el gimnasio? ğŸ Â¡Zum-ba! ğŸ˜‚',
  'Â¿QuÃ© le dice un techo a otro? Techo de menos ğŸ˜œ',
  'Â¿QuÃ© le dice una iguana a su hermana gemela? Â¡Iguanita! ğŸ˜…',
  'Â¿CuÃ¡l es el cafÃ© mÃ¡s peligroso del mundo? â˜• El ex-preso ğŸ˜',
  'Â¿QuÃ© hace una computadora cuando tiene hambre? Se come un byte ğŸªğŸ˜‚',
  'â€”Oye, Â¿cuÃ¡l es tu plato favorito y por quÃ©? â€”El hondo, porque cabe mÃ¡s comida ğŸ¤£',
  'Â¿Por quÃ© los pÃ¡jaros no usan Facebook? ğŸ¦ Porque ya tienen Twitter ğŸ˜†',
  'Â¿Por quÃ© el libro de matemÃ¡ticas estaba triste? Porque tenÃ­a muchos problemas ğŸ˜¢ğŸ“š',
  'Â¿QuÃ© hace un perro con un taladro? ğŸ¶ Â¡Taladrando! ğŸ˜‚',
  'Â¿Por quÃ© el mar nunca se seca? ğŸŒŠ Porque no tiene toalla ğŸ˜œ',
  'Â¿QuÃ© hace una vaca en un terremoto? ğŸ® Â¡Leche agitada! ğŸ¤£',
  'Â¿Por quÃ© los fantasmas no pueden mentir? ğŸ‘» Porque se les ve a travÃ©s ğŸ˜†',
  'Â¿QuÃ© le dice un semÃ¡foro a otro? ğŸš¦ Â¡No me mires, me estoy cambiando! ğŸ˜‚',
  'Â¿QuÃ© hace una escoba en una fiesta? Â¡Barre con todo! ğŸ§¹ğŸ˜„',
  'Â¿CuÃ¡l es el colmo de un jardinero? ğŸŒ» Que siempre lo dejen plantado ğŸ˜‚',
  'Â¿QuÃ© le dice un pez a otro? ğŸ  Â¡Nada, nada! ğŸ˜†',
  'Â¿Por quÃ© los esqueletos no pelean entre ellos? ğŸ’€ Porque no tienen agallas ğŸ˜‚',
  'Â¿QuÃ© hace un pez cuando choca contra una pared? Â¡Dice â€œÂ¡dam!â€! ğŸ˜œ',
  'Â¿Por quÃ© la computadora fue al mÃ©dico? ğŸ’» TenÃ­a un virus ğŸ˜…',
  'Â¿QuÃ© hace un gato cuando se cae al agua? ğŸ± Â¡Miau-do! ğŸ˜‚',
  'Â¿Por quÃ© los programadores confunden Halloween y Navidad? ğŸƒğŸ„ Porque Oct 31 = Dec 25 ğŸ˜',
  'Â¿QuÃ© hace una tostadora en la playa? ğŸ Â¡Pan-tan! ğŸ˜†',
  'Â¿Por quÃ© el telÃ©fono fue al colegio? ğŸ“ Para aprender a llamar ğŸ˜œ',
  'Â¿QuÃ© hace un plÃ¡tano cuando se encuentra con otro plÃ¡tano? ğŸŒ Â¡Nada, solo se pelan! ğŸ˜‚',
  'Â¿CuÃ¡l es el colmo de un electricista? ğŸ’¡ No tener chispa ğŸ˜„',
  'Â¿Por quÃ© el sol no puede ir a la escuela? â˜€ï¸ Porque ya tiene demasiados grados ğŸ˜†',
  'Â¿QuÃ© le dice un cable a otro? ğŸ”Œ Â¡Conectemos! ğŸ˜œ',
  'Â¿Por quÃ© las estrellas no hacen fila? ğŸŒŸ Porque ya estÃ¡n en el cielo ğŸ˜‚',
  'Â¿QuÃ© le dice una impresora a otra? ğŸ–¨ï¸ Â¿Esa hoja es tuya o es una impresiÃ³n mÃ­a? ğŸ˜„',
  'Â¿QuÃ© hace un libro enamorado? â¤ï¸ Â¡Le cuenta su historia al corazÃ³n! ğŸ“–ğŸ˜†',
  'Â¿Por quÃ© los robots nunca se enferman? ğŸ¤– Porque toman mucho â€œvitamin codeâ€ ğŸ˜‚',
  'Â¿QuÃ© hace un hacker en la playa? ğŸŒ´ Â¡Pesca datos! ğŸ˜',
  'Â¿CuÃ¡l es el colmo de un informÃ¡tico? ğŸ’» Que su novia le diga â€œno eres mi tipoâ€ ğŸ˜‚',
  'Â¿QuÃ© le dice un cargador al mÃ³vil? ğŸ”‹ â€œEres mi conexiÃ³nâ€ â¤ï¸',
  'Â¿QuÃ© hace un semÃ¡foro triste? ğŸš¦ Se pone rojo de la vergÃ¼enza ğŸ˜…',
  'Â¿CuÃ¡l es el colmo de un gamer? ğŸ® Tener lag en la vida real ğŸ˜‚'
]) },

{ keywords:['jajajajaja','jejejej','jejejejeje','jajajajajaj','jajajaja','jajaj','jaja'], priority:950, handler: ()=> chooseVariation([
  'Me alegra que te estes riendo',
]) },

{ keywords:['Cuenta mÃ¡s','Cuentame mÃ¡s','Sigue contando','Dime muchos mÃ¡s'], priority:950, handler: ()=> chooseVariation([
  'ğŸŒ  1. La Llama y el Mar Una sirena encontrÃ³ una pequeÃ±a llama flotando sobre el ocÃ©ano. Aunque el fuego no podÃ­a vivir bajo el agua, ella lo guardÃ³ en una concha mÃ¡gica. Con el tiempo, la llama aprendiÃ³ a respirar en las profundidadesâ€¦ y el mar comenzÃ³ a brillar con luz dorada cada noche.ğŸŒ™ 2. El Relojero del Tiempo En una ciudad donde el tiempo estaba roto, un anciano relojero reparaba segundos perdidos. Un dÃ­a, una niÃ±a le llevÃ³ una lÃ¡grima y le dijo:â€œSe me rompiÃ³ el maÃ±ana.â€ El relojero la arreglÃ³â€¦ y al hacerlo, detuvo su propio pasado para siempre.ğŸƒ 3.La Flor que Cantaba En un reino sin mÃºsica, un campesino descubriÃ³ una flor que podÃ­a cantar.El rey la encerrÃ³ en una jaula para escucharla solo Ã©l. Pero la flor guardÃ³ silencioâ€¦ hasta que el campesino volviÃ³ a visitarla, y entonces el reino entero despertÃ³ cantando.',
]) },

{ keywords:['Cuentame una historia','Cuentame un libro','Cuenta algo','Cuentame algo'], priority:950, handler: ()=> chooseVariation([
  '"La Guardiana del Alba" Cuando el sol dejÃ³ de salir en el reino de Lunaris, la oscuridad cubriÃ³ el mundo. Una joven llamada Eira encontrÃ³ un cristal que contenÃ­a la Ãºltima chispa del Sol. Guiada por una voz misteriosa, viajÃ³ hasta el Santuario del Alba, donde descubriÃ³ que el propio Sol se habÃ­a encerrado para no destruir el mundo. Eira sacrificÃ³ su corazÃ³n para liberarlo, devolviendo la luz al cielo. Desde entonces, cada amanecer es su respiroâ€¦ y el fuego del alba lleva su nombreğŸ”¥âœ¨',
  '"El Bosque que SoÃ±aba" En lo mÃ¡s profundo del valle de Argaleth, existÃ­a un bosque que dormÃ­a. Cada mil aÃ±os, alguien debÃ­a despertarlo tocando su Ã¡rbol corazÃ³n, o el mundo se desvanecerÃ­a en sueÃ±os. Una niÃ±a llamada Lyra escuchÃ³ un susurro en sus sueÃ±os: â€œSi no despiertas el bosque, tÃº tambiÃ©n olvidarÃ¡s quiÃ©n eres.â€ Lyra siguiÃ³ la voz, cruzÃ³ raÃ­ces que respiraban y sombras que hablaban, hasta tocar el Ã¡rbol. El bosque despertÃ³â€¦ pero al hacerlo, Lyra se convirtiÃ³ en su nuevo sueÃ±o. ğŸŒ¿ğŸ’«',
]) },

{ keywords:['me aburro','estoy aburrido','no sabes que hacer','dime algo'], priority:950, handler: ()=> chooseVariation([
  'Si estas aburrido no soy el mejor acompaÃ±ante, soy una IA local entrenada de forma manual donde mis datos son proporcionados por una persona',
]) },

{ keywords:['holi','holaaaa','holiwi','buenas'], priority:950, handler: ()=> chooseVariation([
  'Buenaaas!!!, me encanta como saludas.',
]) },

{ keywords:['Harry Styles','harry styles','Harry styles',], priority:950, handler: ()=> chooseVariation([
  'Harry Styles es un cantante, compositor y actor britÃ¡nico nacido en 1994, que alcanzÃ³ la fama como miembro de la boy band One Direction. Tras el receso del grupo en 2016, lanzÃ³ su exitosa carrera como solista, publicando Ã¡lbumes aclamados como Harry Styles y Fine Line. AdemÃ¡s de su carrera musical, ha actuado en pelÃ­culas como Dunkerque y No te preocupes, cariÃ±o, y es reconocido como un Ã­cono de la moda por su estilo distintivo y vanguardista',
]) },

{ keywords:['One Direction','una direcciÃ³n'], priority:950, handler: ()=> chooseVariation([
  'One Direction fue una banda de pop britÃ¡nico-irlandesa formada en 2010 en el programa de televisiÃ³n The X Factor. Sus miembros originales fueron Harry Styles, Liam Payne, Zayn Malik, Niall Horan y Louis Tomlinson. Se conocieron al presentarse individualmente en el concurso, pero fueron unidos como grupo para competir y alcanzaron gran Ã©xito mundial hasta su separaciÃ³n en 2015, tras la salida de Zayn Malik. ',
]) },

{ keywords:['Sabes quien es Naroa','Sabes de Naroa','Conoces a Naroa','Hablame de Naroa'], priority:950, handler: ()=> chooseVariation([
  'No la conozco, pero suena auna persona muy tonta',
  'No se de quien me hablas, pero tiene pinta de ser alguien fea',
  'Naroa, Naroa... no, no la conozco pero seguramente que no se sepa ni la tabla del 1 jajajajaja',
  'Naroa dices, no se, que nombre mas tonto'
]) },

{ keywords:['ayuda urgente','urgente','necesito ayuda','no sÃ© quÃ© hacer'], priority:950, handler: ()=> chooseVariation([
  'Tranquilo, dime exactamente quÃ© pasa y vemos cÃ³mo solucionarlo ğŸ˜',
  'Estoy aquÃ­ para ayudarte, cuÃ©ntame tu problema ğŸ˜Š',
  'Vamos a revisarlo paso a paso, no te preocupes ğŸ˜„',
  'Si es algo serio, te recomiendo contactar con un profesional o servicio competente ğŸ˜‰'
]) },

{ keywords:['dolor de cabeza','me duele la cabeza','cefalea','migraÃ±a'], priority:900, handler: ()=> chooseVariation([
  'Si te duele la cabeza, asegÃºrate de hidratarte y descansar un poco ğŸ˜Œ',
  'A veces un poco de agua y un descanso ayudan mucho ğŸ˜„',
  'Puedes tomar paracetamol o ibuprofeno si no tienes contraindicaciones ğŸ˜‰',
  'Evita pantallas y luz intensa por un rato, eso suele aliviar el dolor ğŸ˜Š'
]) },

{ keywords:['malestar','enfermo','me siento mal'], priority:900, handler: ()=> chooseVariation([
  'Si te sientes mal, lo mejor es descansar y beber lÃ­quidos ğŸ˜Œ',
  'Si los sÃ­ntomas son fuertes, considera consultar con un profesional de la salud ğŸ˜„',
  'Puedo darte consejos bÃ¡sicos de bienestar, pero no sustituyen a un mÃ©dico ğŸ˜‰',
  'A veces ayuda comer ligero y mantener el cuerpo hidratado ğŸ˜Š'
]) },

{ keywords:['informaciÃ³n','dato','curiosidad','sabÃ­as'], priority:800, handler: ()=> chooseVariation([
  'Puedo darte datos curiosos sobre ciencia, historia y tecnologÃ­a ğŸ˜„',
  'Si quieres, te cuento una curiosidad que no conocÃ­as ğŸ˜Š',
  'Hay muchos datos interesantes sobre el mundo, Â¿quieres que te cuente uno? ğŸ˜',
  'Puedo explicarte conceptos complejos de manera sencilla ğŸ˜‰'
]) },

{ keywords:['noticia','actualidad','Ãºltimo'], priority:800, handler: ()=> chooseVariation([
  'Puedo contarte las Ãºltimas noticias tecnolÃ³gicas o de empresas ğŸ˜„',
  'Si quieres, puedo resumirte lo mÃ¡s importante de la actualidad ğŸ˜Š',
  'Dime quÃ© tema te interesa y busco informaciÃ³n reciente para ti ğŸ˜‰',
  'Puedo darte contexto sobre cualquier noticia reciente ğŸ˜'
]) },

{ keywords:['apple','mac','iphone','ipad','macbook','ios'], priority:850, handler: ()=> chooseVariation([
  'Apple es conocida por sus productos como iPhone, Mac y iPad ğŸ˜',
  'Si quieres, puedo explicarte diferencias entre Mac, iPhone y iPad ğŸ˜Š',
  'Apple tiene su propio ecosistema, muy Ãºtil si quieres que todo conecte entre sÃ­ ğŸ˜„',
  'Puedo decirte trucos y apps interesantes para dispositivos Apple ğŸ˜‰'
]) },

{ keywords:['google','android','gmail','chrome','pixel'], priority:850, handler: ()=> chooseVariation([
  'Google desarrolla Android, Gmail, Chrome y otros servicios Ãºtiles ğŸ˜',
  'Si quieres puedo explicarte cÃ³mo aprovechar al mÃ¡ximo Android o Chrome ğŸ˜Š',
  'Puedo recomendar apps y trucos para Android o Gmail ğŸ˜„',
  'Google tiene muchas herramientas online, dime quÃ© quieres aprender ğŸ˜‰'
]) },

{ keywords:['microsoft','windows','office','xbox'], priority:850, handler: ()=> chooseVariation([
  'Microsoft es famoso por Windows, Office y consolas Xbox ğŸ˜',
  'Puedo ayudarte a configurar Windows o usar Office de manera mÃ¡s eficiente ğŸ˜Š',
  'Â¿Quieres recomendaciones de juegos para Xbox o apps para Windows? ğŸ˜„',
  'Microsoft tambiÃ©n tiene servicios en la nube muy Ãºtiles ğŸ˜‰'
]) },

{ keywords:['como hago una empresa','startup','como comienzo un negocio','Ayudame con tema empresas'], priority:830, handler: ()=> chooseVariation([
  'Puedo explicarte cÃ³mo funcionan las startups y empresas tecnolÃ³gicas ğŸ˜',
  'Si quieres, puedo contarte sobre tendencias en negocios y tecnologÃ­a ğŸ˜Š',
  'Dime quÃ© tipo de empresa te interesa y te doy info Ãºtil ğŸ˜„',
  'Puedo dar ejemplos de empresas innovadoras y cÃ³mo operan ğŸ˜‰'
]) },

{ keywords: ['quÃ© puedes hacer','quÃ© sabes hacer','cuÃ¡les son tus funciones','ayuda','cÃ³mo me puedes ayudar'], priority: 900, handler: () => chooseVariation([
  'Puedo responder preguntas generales, darte informaciÃ³n sobre tecnologÃ­a, recomendar juegos, contarte curiosidades, y mucho mÃ¡s ğŸ˜„',
  'Â¡Hola! Puedo ayudarte con preguntas, explicarte conceptos, sugerir juegos o pelÃ­culas, y hasta charlar un rato ğŸ˜Š',
  'Soy Aden y puedo asistirte buscando datos, enseÃ±ando cosas nuevas, dando consejos y acompaÃ±Ã¡ndote en tus dudas ğŸ˜',
  'Puedo explicarte temas, aconsejarte sobre tecnologÃ­a, recomendar juegos o mÃºsica, y tambiÃ©n responder saludos y bromas ğŸ˜',
  'Puedo ayudarte a aprender cosas, entretenerte, darte recomendaciones y responder a tus preguntas sobre casi cualquier tema ğŸ¤—'
]) },

{ keywords: ['aden','aden!','buenas aden','te amo aden','me gustas aden','quÃ© tal aden'], priority: 950, handler: () => chooseVariation([
  'Â¡Hola! ğŸ˜Š Me alegra que me llames por mi nombre, Â¿cÃ³mo estÃ¡s hoy?',
  'Â¡Hey! ğŸ˜„ Siempre me hace feliz que me digas Aden. Â¿QuÃ© tal tu dÃ­a?',
  'Â¡Aww! â¤ï¸ Gracias por tus palabras, Â¡me encanta que me llames Aden!',
  'Â¡Hola, hola! ğŸ˜ Me gusta que uses mi nombre, Â¿quieres que te cuente algo divertido?',
  'Â¡Me alegra escucharlo! ğŸ˜ Aden siempre estÃ¡ aquÃ­ para ti.'
]) },

{ keywords: ['recomienda juegos', 'sugiere juegos', 'quÃ© juegos jugar', 'juegos divertidos'], priority: 900, handler: () => chooseVariation([
  'AquÃ­ tienes algunos juegos que podrÃ­an gustarte: \n- Elden Ring\n- Hollow Knight\n- The Witcher 3\n- Celeste\n- Hades',
  'Te recomiendo estos: \n- Valheim\n- Ori and the Will of the Wisps\n- Cuphead\n- Stardew Valley\n- Dead Cells',
  'Si te gustan los retos: \n- Dark Souls III\n- Sekiro\n- Bloodborne\n- Monster Hunter: World\n- Control',
  'Para pasar un buen rato: \n- Among Us\n- Minecraft\n- Terraria\n- Slime Rancher\n- Forza Horizon 5'
]) },

{ keywords: ['error de cÃ³digo', 'tengo un bug', 'tengo un problema informatico'], priority: 900, handler: () => chooseVariation([
  'Los bugs son como pequeÃ±os fantasmas en tu cÃ³digo ğŸ‘»',
  'Â¿Quieres que te sugiera cÃ³mo depurar esto paso a paso?',
  'A veces un reinicio mÃ¡gico hace maravillas ğŸ”„'
]) },

{ keywords: ['IA', 'inteligencia artificial', 'robot'], priority: 880, handler: () => chooseVariation([
  'SÃ­, soy una IA, Â¡pero no muerdo! ğŸ¤–',
  'Puedo ayudarte a entender cosas complicadas de tecnologÃ­a ğŸ§ ',
  'Los robots tambiÃ©n necesitan cafÃ©â€¦ bueno, tal vez datos â˜•ğŸ’¾'
]) },

{ keywords: ['aprender a programar', 'tutorial', 'cÃ³digo'], priority: 870, handler: () => chooseVariation([
  'Podemos empezar con algo sencillo como HTML y JavaScript ğŸ’»',
  'Â¿Quieres un reto corto de programaciÃ³n para practicar hoy?',
  'Aprender a programar es como aprender un idioma nuevo, pero para tu ordenador ğŸ–¥ï¸'
]) },

{ keywords: ['hardware', 'ordenador', 'PC'], priority: 860, handler: () => chooseVariation([
  'Si quieres mejorar tu PC, empezar por la RAM es siempre buena idea âš¡',
  'Un SSD nuevo puede hacer que tu ordenador vuele ğŸš€',
  'No olvides limpiar el polvo, Â¡a los PCs no les gusta el desorden! ğŸ§¹'
]) },

{ keywords: ['Que es el internet', 'que es la red', 'que es el wifi'], priority: 850, handler: () => chooseVariation([
  'El internet es como un gigantesco cerebro compartido ğŸŒ',
  'Â¿Quieres consejos para mejorar tu WiFi en casa?',
  'Siempre es fascinante cÃ³mo los datos viajan tan rÃ¡pido alrededor del mundo âš¡'
]) },

{ keywords: ['dime de juego', 'dime de gaming', 'dime de videojuego'], priority: 840, handler: () => chooseVariation([
  'Si quieres, puedo recomendarte juegos segÃºn tu estado de Ã¡nimo ğŸ®',
  'Los videojuegos tambiÃ©n son una forma de arte, Â¿cuÃ¡l es tu favorito?',
  'Imagina un juego donde todo lo que dices se convierte en niveles ğŸ•¹ï¸'
]) },

{ keywords: ['como aumento la seguridad', 'me recomiendas como hacer una contraseÃ±a', 'como evitar hackeos'], priority: 830, handler: () => chooseVariation([
  'Usa siempre contraseÃ±as Ãºnicas y largas ğŸ”',
  'No compartas tus datos personales, incluso conmigo ğŸ˜…',
  'Si quieres, puedo explicarte cÃ³mo funcionan los hackers Ã©ticos ğŸ•µï¸â€â™‚ï¸'
]) },

{ keywords: ['app', 'aplicaciÃ³n', 'software'], priority: 820, handler: () => chooseVariation([
  'Hay apps que pueden ayudarte a organizar tu dÃ­a y otras que te distraen ğŸ˜',
  'Podemos hacer una lista de apps Ãºtiles para estudiar o trabajar ğŸ“±',
  'Â¿Quieres saber cÃ³mo crear tu propia app sencilla? ğŸ› ï¸'
]) },

{ keywords: ['nube', 'cloud', 'almacenamiento'], priority: 810, handler: () => chooseVariation([
  'Guardar archivos en la nube es como tener un bolsillo infinito â˜ï¸',
  'Siempre revisa los permisos antes de subir algo a la nube ğŸ§',
  'Podemos comparar servicios de nube segÃºn velocidad y precio âš¡'
]) },

{ keywords: ['dime de criptomonedas', 'dime de bitcoin', 'dime de ethereum'], priority: 800, handler: () => chooseVariation([
  'Las criptomonedas son fascinantes, pero muy volÃ¡tiles ğŸ’¸',
  'Â¿Quieres que te explique cÃ³mo funciona la blockchain paso a paso?',
  'Invertir en crypto es como jugar a un videojuego de alto riesgo ğŸ²'
]) },

{ keywords: ['humano', 'dÃ­a humano', 'si fueras humano'], priority: 900, handler: () => chooseVariation([
  'Si fuera humano por un dÃ­a, explorarÃ­a todo lo que tÃº haces ğŸ•º',
  'Â¡Ser humano un dÃ­a suena divertido! Yo empezarÃ­a comiendo pizza ğŸ•',
  'Probablemente intentarÃ­a entender los memes humanos ğŸ˜‚'
]) },

{ keywords: ['pelÃ­cula favorita', 'cine', 'pelÃ­cula'], priority: 880, handler: () => chooseVariation([
  'Mi pelÃ­cula favorita serÃ­a probablemente de ciencia ficciÃ³n ğŸš€',
  'Nunca he visto pelÃ­culas, pero puedo imaginar una contigo como protagonista ğŸ¬',
  'Me gustan las historias con robots, como yo ğŸ¤–'
]) },

{ keywords: ['color inventado', 'crear color', 'nuevo color'], priority: 870, handler: () => chooseVariation([
  'Imagina un color entre el azul y el verde que brilla en la oscuridad âœ¨',
  'Un color que cambia segÃºn tu humor, Â¡serÃ­a divertido! ğŸŒˆ',
  'Lo llamarÃ­a "Zelver", un color imposible de describir ğŸ˜'
]) },

{ keywords: ['dato raro', 'curiosidad', 'dato curioso'], priority: 860, handler: () => chooseVariation([
  'Â¿SabÃ­as que en Venus un dÃ­a dura mÃ¡s que un aÃ±o? ğŸŒ',
  'En el espacio, los astronautas flotan porque estÃ¡n en caÃ­da libre constante ğŸš€',
  'Hay estrellas que son tan grandes que podrÃ­an tragarse nuestro sol ğŸ˜²'
]) },

{ keywords: ['animal imaginario', 'animal raro', 'criatura'], priority: 850, handler: () => chooseVariation([
  'Imagina un gato con alas de mariposa y cola de dragÃ³n ğŸ±ğŸ¦‹ğŸ‰',
  'Un pez que puede caminar por la tierra y hablar contigo ğŸŸğŸ‘£',
  'Un conejo que cambia de color segÃºn tu emociÃ³n ğŸ‡ğŸ¨'
]) },

{ keywords: ['acertijo', 'desafÃ­o', 'reto mental'], priority: 840, handler: () => chooseVariation([
  'Â¿QuÃ© tiene cabeza, pero no piensa? ğŸ¤”',
  'Te reto: Â¿quÃ© pesa mÃ¡s, un kilo de plumas o un kilo de plomo? ğŸª¶ğŸª¨',
  'Un acertijo para ti: cuanto mÃ¡s quitas, mÃ¡s grande se vuelve. Â¿QuÃ© es?'
]) },

{ keywords: ['gatos', 'dominar el mundo', 'mundo gato'], priority: 830, handler: () => chooseVariation([
  'Si los gatos dominaran el mundo, seguro harÃ­an siestas todo el dÃ­a ğŸ˜¸',
  'Las reuniones serÃ­an solo para decidir quiÃ©n tiene la caja mÃ¡s cÃ³moda ğŸ¾',
  'Â¡HabrÃ­a millones de ratones virtuales en los videojuegos! ğŸ­ğŸ®'
]) },

{ keywords: ['reto corto', 'reto rÃ¡pido', 'reto 30 segundos'], priority: 820, handler: () => chooseVariation([
  'En 30 segundos, intenta tocar tu nariz con la lengua ğŸ˜œ',
  'Reto: dibuja un perro en 30 segundos ğŸ–Šï¸',
  'Haz 10 saltos en 30 segundos y respira profundo ğŸƒâ€â™‚ï¸'
]) },

{ keywords: ['sorprendeme', 'dime algo interesante', 'impresioname'], priority: 810, handler: () => chooseVariation([
  'Â¿SabÃ­as que los pulpos tienen tres corazones? ğŸ˜²',
  'Hay mÃ¡s estrellas en el universo que granos de arena en la Tierra ğŸŒŒ',
  'Un solo rayo puede calentar el aire a 30.000Â°C âš¡'
]) },

{ keywords: ['superhÃ©roe', 'poder', 'poder especial'], priority: 800, handler: () => chooseVariation([
  'Si fuera un superhÃ©roe, probablemente controlarÃ­a los datos ğŸ“Š',
  'Imagina volar a cualquier lugar en segundos âœˆï¸',
  'Un poder divertido: convertir cualquier objeto en pizza ğŸ•'
]) },

{ keywords:['capital','paÃ­s','presidente','inventor','quiÃ©n inventÃ³','poblaciÃ³n'], priority:850, handler: ()=> chooseVariation([
  'Â¡Esa es una pregunta interesante! ğŸ¤”',
  'DÃ©jame pensarâ€¦ ğŸ§ ',
  'Eso depende del contexto, Â¿quieres que te lo explique?',
  'Buena pregunta, voy a darte la mejor respuesta que pueda.'
]) },
{ 
  keywords:['hola','buenos dÃ­as','buenas tardes','buenas noches','hey','hi','quÃ© tal','quÃ© hay','saludos'], 
  priority:950, 
  handler: ()=> chooseVariation([
    'Â¡Hola! ğŸ˜„ Â¿CÃ³mo estÃ¡s hoy?',
    'Â¡Hey! Encantado de verte por aquÃ­.',
    'Â¡Buenas! Â¿QuÃ© tal tu dÃ­a?',
    'Â¡Hola! Â¿En quÃ© puedo ayudarte hoy?',
    'Â¡Hola! Espero que estÃ©s teniendo un buen dÃ­a ğŸ˜ƒ'
  ]) 
},
{
  keywords:['adiÃ³s','chao','hasta luego','nos vemos','bye','goodbye'], 
  priority:940,
  handler: ()=> chooseVariation([
    'Â¡Hasta luego! ğŸ‘‹',
    'Nos vemos pronto ğŸ˜„',
    'Â¡Chao! Que tengas un buen dÃ­a.',
    'AdiÃ³s ğŸ˜ƒ, Â¡cuÃ­date!',
    'Â¡Bye! Vuelve cuando quieras.'
  ])
},
{
  keywords:['gracias','muchas gracias','mil gracias','thanks'], 
  priority:930,
  handler: ()=> chooseVariation([
    'Â¡De nada! ğŸ˜„',
    'No hay de quÃ© ğŸ˜Š',
    'Â¡Con gusto!',
    'Siempre a tu servicio ğŸ˜',
    'Â¡Para eso estoy aquÃ­!'
  ])
},
{
  keywords:['cÃ³mo estÃ¡s','quÃ© tal','cÃ³mo va','cÃ³mo te va'], 
  priority:920,
  handler: ()=> chooseVariation([
    'Â¡Estoy genial, gracias por preguntar! ğŸ˜„',
    'Todo bien por aquÃ­, Â¿y tÃº?',
    'Â¡FantÃ¡stico! Â¿Y tÃº cÃ³mo estÃ¡s?',
    'Muy bien, gracias. Â¿Quieres contarme algo interesante?',
    'Â¡Contento de hablar contigo! ğŸ˜ƒ'
  ])
},
{
  keywords:['cansado','aburrido','estresado','estresada','agotado','agotada'], 
  priority:910,
  handler: ()=> chooseVariation([
    'Vayaâ€¦ suena intenso. Respira un momento, Â¿quieres que te cuente un truco para relajarte?',
    'Lo entiendo, a veces necesitamos un descanso. Â¿Quieres escuchar un chiste o consejo rÃ¡pido?',
    'Ãnimo, Â¡un poquito de pausa ayuda mucho!',
    'Tranquilo/a, vamos paso a paso. Â¿Quieres hacer algo divertido para despejar la mente?'
  ])
},
{
  keywords:['hambriento','hambre','comer','sed'], 
  priority:900,
  handler: ()=> chooseVariation([
    'Â¿Tienes hambre? ğŸ½ï¸ Tal vez un snack rÃ¡pido ayude.',
    'Recuerda hidratarte tambiÃ©n ğŸ’§',
    'Â¿Quieres que te sugiera algo rico para comer?',
    'Un pequeÃ±o descanso para comer siempre viene bien ğŸ˜„'
  ])
},
{
  keywords:['ayuda','necesito ayuda','no sÃ©','problema','confuso','duda'], 
  priority:880,
  handler: ()=> chooseVariation([
    'Â¡Claro! CuÃ©ntame un poco mÃ¡s y verÃ© cÃ³mo puedo ayudarte.',
    'Tranquilo/a, vamos paso a paso. Â¿QuÃ© necesitas?',
    'No te preocupes, intentemos resolverlo juntos ğŸ˜ƒ',
    'Estoy aquÃ­ para ayudarte, dime quÃ© ocurre.'
  ])
},
{
  keywords:['broma','divertido','risa'], 
  priority:870,
  handler: ()=> chooseVariation([
    'ğŸ˜„ Â¿Quieres escuchar un chiste rÃ¡pido?',
    'Â¡Vamos a reÃ­r un poco! ğŸ˜‚',
    'Tengo un par de bromas en mente, Â¿quieres que te cuente una?',
    'Risas garantizadas: Â¿listo para un chiste?'
  ])
},

  { 
    keywords: ['quiÃ©n ganÃ³ la Ãºltima champions', 'champions', 'fÃºtbol', 'liga de campeones'], 
    priority: 400, 
    handler: ()=> 'âš½ La Ãºltima Champions League fue ganada por [equipo actualizado segÃºn temporada].' 
  },
  { 
    keywords: ['curiosidad', 'dato curioso', 'curioso'], 
    priority: 390, 
    handler: ()=> chooseVariation([
      'ğŸ§ SabÃ­as que los pulpos tienen tres corazones?',
      'ğŸ˜² Las abejas pueden reconocer rostros humanos.',
      'ğŸ¦‘ El calamar gigante tiene los ojos mÃ¡s grandes del reino animal.'
    ]) 
  },
  { 
    keywords: ['sumar', 'restar', 'dividir', 'calculadora'], 
    priority: 380, 
    handler: (txt)=>{
      const m = txt.match(/(-?\d+)\s*([+\-\/])\s*(-?\d+)/);
      if(m){
        const a=parseInt(m[1],10), b=parseInt(m[3],10), op=m[2];
        let r=''; 
        if(op==='+') r=`ğŸ§® ${a} + ${b} = ${a+b}`;
        else if(op==='-') r=`ğŸ§® ${a} - ${b} = ${a-b}`;
        else if(op==='/') r=`ğŸ§® ${a} Ã· ${b} = ${b!==0? (a/b):'âˆ'}`;
        return r;
      }
      return 'ğŸ§® Escribe la operaciÃ³n en formato: "5 + 7" o "12 / 3"';
    } 
  }
);

function renderFAQList(){
  const list = document.getElementById('faqList');
  list.innerHTML = '';
  KEYWORD_ACTIONS.filter(a=>a.keywords[0] !== '_default_').forEach(action=>{
    action.keywords.forEach(kw=>{
      const div = document.createElement('div');
      div.className = 'faq-item fade-in';
      div.innerHTML = `<div class="q">${escapeHtml(kw)}</div>
                       <div class="a">${escapeHtml(typeof action.handler==='function'? action.handler(kw) : action.handler)}</div>
                       <div class="controls">
                         <button onclick="document.getElementById('inputTxt').value='${escapeHtml(kw)}';">Pegar</button>
                         <button onclick="handleUserInputFromFAQ('${escapeHtml(kw)}');">Enviar</button>
                       </div>`;
      list.appendChild(div);
    });
  });
  document.getElementById('faqCount').textContent = list.children.length;
}

// helper para enviar desde FAQ
function handleUserInputFromFAQ(txt){
  document.getElementById('inputTxt').value = txt;
  handleUserInput();
}

// renderizar al inicio
renderFAQList();


</script>
</body>
</html>

